#!/bin/bash

# Get script directory, and cd to it
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ] ; do SOURCE="$(readlink "$SOURCE")"; done
d="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
cd "$d"


# Create methods database
rm -f "$d/methods.db.gz"

curl "https://rsw.me.uk/blueline/data/methods.csv" > "$d/methods.csv"

sqlite3 "$d/methods.db" <<IMPORT
CREATE TABLE methods(title, provisional, url, stage INTEGER, classification, nameMetaphone, notation, notationExpanded, leadHeadCode, leadHead, fchGroups, lengthOfLead INTEGER, numberOfHunts INTEGER, little, differential, plain, trebleDodging, palindromic, doubleSym, rotational, calls, ruleOffs, callingPositions, magic INTEGER);
.mode csv methods
.import methods.csv methods
DELETE FROM methods WHERE stage > 12;
IMPORT

gzip -9 "$d/methods.db"

rm -f "$d/methods.csv"


# Create database for user data
rm "$d/user_data.db.gz"
sqlite3 "$d/user_data.db" <<IMPORT
CREATE TABLE stars(title UNIQUE, stage INTEGER, notationExpanded);
IMPORT

gzip -9 "$d/user_data.db"
